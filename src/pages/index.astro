---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const recentPosts = sortedPosts.slice(0, 3); // Show only 3 recent posts
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index">
    <section id="hero" class="pt-8 pb-6">
      <h2 class="mt-8 mb-4 text-2xl font-semibold">üëã About Me</h2>
      <p class="mb-6">
        Software engineer driven by curiosity and a passion for creating my own
        solutions. I enjoy experimenting with new technologies and working on
        diverse projects.
      </p>

      <h2 class="mt-8 mb-4 text-2xl font-semibold">üíº Work</h2>
      <p class="mb-6">
        I work at <strong>NTT Communications</strong> (2019 - Present) developing
        the WebRTC platform SkyWay that enables real-time communication on the web.
        My work involves full-stack development of the platform's backend services,
        JavaScript SDK development, and frontend components that enable video calls
        and real-time messaging. I also work with cloud infrastructure on AWS and GCP.
      </p>

      <h2 class="mt-8 mb-4 text-2xl font-semibold">üõ†Ô∏è Projects</h2>
      <p class="mb-4">
        I enjoy building various tools and applications in my spare time,
        from developer productivity tools to everyday utility apps.
        These projects help me explore new technologies and solve interesting
        problems.
      </p>
      <div class="mb-6">
        <LinkButton href="/projects/">
          View All Projects
          <IconArrowRight class="inline-block rtl:-rotate-180" />
        </LinkButton>
      </div>

      <h2 class="mt-8 mb-4 text-2xl font-semibold">üéì Education</h2>
      <p class="mb-4">
        I completed my <strong>Master's degree in Computer Science</strong> at Kwansei
        Gakuin University (2017-2019), focusing on Network Science and mathematical modeling.
        My research was on "Studies on Geographic DTN Routing with Random Mobile Agents,"
        analyzing DTN (Delay/Disruption-Tolerant Networking) routing algorithms and
        mobile agent behavior in challenged network environments.
      </p>
      <p class="mb-6">
        <a
          href="/thesis.pdf"
          class="underline decoration-dashed underline-offset-4 hover:text-accent"
          target="_blank"
          rel="noopener noreferrer"
        >
          View Thesis (PDF)
        </a>
      </p>
    </section>

    {
      recentPosts.length > 0 && (
        <>
          <Hr />
          <section id="recent-posts" class="pt-12 pb-6">
            <h2 class="mb-4 text-2xl font-semibold tracking-wide">
              üìù Recent Posts
            </h2>
            <ul>
              {recentPosts.map(data => (
                <Card variant="h3" {...data} />
              ))}
            </ul>
            <div class="mt-8 text-center">
              <LinkButton href="/posts/">
                View All Posts
                <IconArrowRight class="inline-block rtl:-rotate-180" />
              </LinkButton>
            </div>
          </section>
        </>
      )
    }
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
