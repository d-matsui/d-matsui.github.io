---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Socials from "@/components/Socials.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const recentPosts = sortedPosts.slice(0, 3); // Show only 3 recent posts
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index">
    <section id="hero" class="pt-8 pb-6">
      <h1 class="my-4 inline-block text-4xl font-bold sm:my-8 sm:text-5xl">
        Hi, I'm Daiki Matsui
      </h1>

      <p class="mb-4">
        I'm a software engineer passionate about technology, AI, and continuous
        learning.
      </p>

      <h2 class="mt-8 mb-4 text-2xl font-semibold">About Me</h2>

      <p class="mb-4">
        This site serves as my digital garden where I document my learning
        journey, share technical insights, and showcase projects I'm working on.
      </p>

      <h3 class="mt-6 mb-3 text-xl font-semibold">Interests</h3>
      <ul class="ms-4 mb-4 list-inside list-disc">
        <li>
          <strong>Software Engineering</strong>: Building robust and scalable
          applications
        </li>
        <li>
          <strong>Artificial Intelligence</strong>: Exploring machine learning
          and AI applications
        </li>
        <li>
          <strong>Programming Languages</strong>: Currently learning Rust and
          exploring modern development tools
        </li>
        <li>
          <strong>Open Source</strong>: Contributing to and learning from the
          community
        </li>
      </ul>

      <h3 class="mt-6 mb-3 text-xl font-semibold">Purpose of This Site</h3>
      <ol class="ms-4 mb-4 list-inside list-decimal">
        <li>
          <strong>Learning Journal</strong>: Documenting my technical journey
          and discoveries
        </li>
        <li>
          <strong>Knowledge Sharing</strong>: Helping others who might face
          similar challenges
        </li>
        <li>
          <strong>Portfolio</strong>: Showcasing projects and technical
          capabilities
        </li>
      </ol>

      <div class="mt-8 flex gap-4">
        <LinkButton href="/projects/">
          View My Projects
          <IconArrowRight class="inline-block rtl:-rotate-180" />
        </LinkButton>
        <LinkButton href="/posts/">
          Read Blog Posts
          <IconArrowRight class="inline-block rtl:-rotate-180" />
        </LinkButton>
      </div>

      <h3 class="mt-8 mb-3 text-xl font-semibold">Connect</h3>
      <p class="mb-4">Feel free to reach out or follow my work:</p>
      <ul class="ms-4 mb-4 list-inside list-disc">
        <li>
          GitHub: <a
            href="https://github.com/d-matsui"
            class="underline decoration-dashed underline-offset-4 hover:text-accent"
            >@d-matsui</a>
        </li>
        <li>More links coming soon...</li>
      </ul>

      {
        // only display if at least one social link is enabled
        SOCIALS.length > 0 && (
          <div class="mt-6 flex flex-col sm:flex-row sm:items-center">
            <Socials />
          </div>
        )
      }
    </section>

    {
      recentPosts.length > 0 && (
        <>
          <Hr />
          <section id="recent-posts" class="pt-12 pb-6">
            <h2 class="mb-4 text-2xl font-semibold tracking-wide">
              Recent Posts
            </h2>
            <ul>
              {recentPosts.map(data => (
                <Card variant="h3" {...data} />
              ))}
            </ul>
            <div class="mt-8 text-center">
              <LinkButton href="/posts/">
                View All Posts
                <IconArrowRight class="inline-block rtl:-rotate-180" />
              </LinkButton>
            </div>
          </section>
        </>
      )
    }

    <Hr />

    <section id="tech-stack" class="pt-8 pb-6">
      <h3 class="mb-3 text-xl font-semibold">Tech Stack</h3>
      <p class="mb-3">This website is built with:</p>
      <ul class="ms-4 list-inside list-disc">
        <li>
          <a
            href="https://astro.build/"
            class="underline decoration-dashed underline-offset-4 hover:text-accent"
            >Astro</a
          > - Static Site Generator
        </li>
        <li>
          <a
            href="https://tailwindcss.com/"
            class="underline decoration-dashed underline-offset-4 hover:text-accent"
            >Tailwind CSS</a
          > - Styling
        </li>
        <li>
          <a
            href="https://www.typescriptlang.org/"
            class="underline decoration-dashed underline-offset-4 hover:text-accent"
            >TypeScript</a
          > - Type Safety
        </li>
        <li>
          Deployed on <a
            href="https://pages.github.com/"
            class="underline decoration-dashed underline-offset-4 hover:text-accent"
            >GitHub Pages</a>
        </li>
      </ul>
    </section>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
